<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Planes de Evaluación de mis Grupos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .back-to-home {
            display: inline-flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .back-to-home i {
            margin-right: 5px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <!-- Encabezado -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Planes de Evaluación de mis Grupos</h2>
        <a th:href="@{/evaluation-plans/create}" class="btn btn-success">
            + Crear Nuevo Plan
        </a>
    </div>

    <!-- Selector de grupo -->
    <form method="get" class="mb-4">
        <label for="groupSelect" class="form-label">Ver planes de un grupo específico:</label>
        <div class="input-group">
            <select id="groupSelect" name="groupId" class="form-select" 
                    onchange="if(this.value) window.location.href = '/evaluation-plans/group/' + this.value;">
                <option value="" disabled selected>Selecciona un grupo...</option>
                <option th:each="enroll : ${studentGroups}" 
                        th:value="${enroll.group.number + '-' + enroll.group.subjectCode + '-' + enroll.group.semester}"
                        th:text="${enroll.group.subjectCode + ' - Grupo ' + enroll.group.number + ' (' + enroll.group.semester + ')'}">
                </option>
            </select>
        </div>
    </form>

    <!-- Mensaje si no hay planes -->
    <div th:if="${#lists.isEmpty(plans)}" class="alert alert-info text-center">
        <h5>No hay planes de evaluación disponibles en tus grupos.</h5>
    </div>

    <!-- Tabla de planes -->
    <div th:if="${!#lists.isEmpty(plans)}" class="table-responsive">
        <table class="table table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Título del Plan</th>
                    <th>Grupo</th>
                    <th>Actividades</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="plan : ${plans}">
                    <td><strong th:text="${plan.title}"></strong></td>
                    <td><span class="badge bg-primary" th:text="${plan.groupId}"></span></td>
                    <td><span class="badge bg-secondary" th:text="${#lists.size(plan.activities)} + ' actividades'"></span></td>
                    <td>
                        <div class="btn-group">
                            <!-- Solo mostrar acciones si el plan fue creado por el usuario -->
                            <div th:if="${#authentication.name == plan.createdByStudentId}">
                                <a th:href="@{/evaluation-plans/edit/{id}(id=${plan.id})}" class="btn btn-outline-warning btn-sm">Editar</a>
                                <form th:action="@{/evaluation-plans/delete/{id}(id=${plan.id})}" method="post" style="display:inline;">
                                    <input type="hidden" name="_method" value="delete"/>
                                    <button type="submit" class="btn btn-outline-danger btn-sm"
                                            onclick="return confirm('¿Estás seguro de eliminar este plan?')">Eliminar</button>
                                </form>
                            </div>
                            <!-- Mensaje si no es el creador -->
                            <div th:unless="${#authentication.name == plan.createdByStudentId}">
                                <span class="text-muted small">Solo lectura</span>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Volver -->
    <div class="mt-4">
        <a th:href="@{/home}" class="btn btn-outline-primary back-to-home">
            <i class="bi bi-arrow-left"></i> Volver al Inicio
        </a>
    </div>
</div>
</body>
</html>
